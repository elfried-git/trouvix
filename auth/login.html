<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion - Trouvix</title>
    <link rel="stylesheet" href="auth.css">
    <link rel="stylesheet" href="../style.css">
</head>
<body class="body">
    <header>
        <div class="header-row">
            <div class="logo" tabindex="0" aria-label="Accueil Trouvix">
                <span class="logo-text">Trouvix</span>
            </div>
            <button id="close-menu" class="close-menu" aria-label="Fermer le menu" style="display:none">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="#0ff1ce" stroke-width="3"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="8" y1="8" x2="24" y2="24" />
                    <line x1="24" y1="8" x2="8" y2="24" />
                </svg>
            </button>
            <nav id="main-nav" class="main-nav" aria-label="Navigation principale">
                <ul>
                    <li><a href="../index.html">Accueil</a></li>
                    <li><a href="../index.html#contact">Contact</a></li>
                    <li id="menu-user-icon" style="display:none">
                        <a href="../pages/espace-membre.php" title="Espace membre" style="display:flex;align-items:center;gap:0.4em;">
                            <span style="font-size:1.5em;">üë§</span>
                            <span id="menu-user-nom" style="font-size:1em;"></span>
                        </a>
                    </li>
                    <li id="menu-logout-link" style="display:none"><form action="../pages/logout.php" method="post" style="display:inline;"><button type="submit" style="background:none;border:none;color:#0ff1ce;font-size:1em;cursor:pointer;">D√©connexion</button></form></li>
                </ul>
            </nav>
        </div>
    </header>
        <div class="hote-login-main" style="min-height:80vh;display:flex;align-items:center;justify-content:center;">
            <div class="hote-login-container" style="display:flex;gap:4em;align-items:stretch;justify-content:center;">
                <div class="login-info-demo-outer" style="display:flex;align-items:center;justify-content:center;">
                    <div class="login-info-demo" style="background:#181c3a;border-radius:1.2em;padding:2em 2em 2em 2em;box-shadow:0 0 32px #00fff966,0 0 0 3px #00fff933,0 0 80px 8px #ff00ff22;border:1.5px solid #00fff9;min-width:220px;max-width:270px;color:#fff;display:flex;flex-direction:column;justify-content:center;">
                            <h3 style="color:#00fff9;margin-bottom:1.2em;font-size:1.18em;text-align:center;text-shadow:0 0 8px #00fff9cc;">Comptes de test</h3>
                            <div style="margin-bottom:1.5em;font-size:1.08em;">
                                    <strong>Email :</strong> <span style="color:#0ff1ce;">trouvix@mailinator.com</span><br>
                                    <strong>Mot de passe :</strong> <span style="color:#0ff1ce;">user1</span>
                            </div>
                            <div style="font-size:1.08em;">
                                    <strong>Email :</strong> <span style="color:#0ff1ce;">benchou@mailinator.com</span><br>
                                    <strong>Mot de passe :</strong> <span style="color:#0ff1ce;">user2</span>
                            </div>
                            <div style="font-size:1.08em;">
                                    <strong>Email :</strong> <span style="color:#0ff1ce;">ferrari@mailina.com</span><br>
                                    <strong>Mot de passe :</strong> <span style="color:#0ff1ce;">user3</span>
                            </div>
                    </div>
                </div>
                <div class="hote-login-form-block-outer" style="display:flex;align-items:center;justify-content:center;">
                    <div class="hote-login-form-block" style="flex:1;display:flex;flex-direction:column;justify-content:center;background:#181c3a;border-radius:1.2em;padding:2em 2em 2em 2em;box-shadow:0 0 32px #00fff966,0 0 0 3px #00fff933,0 0 80px 8px #ff00ff22;border:1.5px solid #00fff9;max-width:420px;">
                            <div class="hote-title" style="color:#00fff9;text-align:center;font-size:2em;margin-bottom:1.2em;text-shadow:0 0 8px #00fff9cc;">Connexion H√¥te</div>
                            <form id="hote-login-form" autocomplete="off">
                                    <div class="form-group">
                                            <label class="form-label" for="register-email">Email</label>
                                            <input class="form-input" id="register-email" name="email" type="email" placeholder="Email" required>
                                    </div>
                                    <div class="form-group">
                                            <label class="form-label" for="hote-otp">OTP</label>
                                            <input class="form-input" id="hote-otp" name="otp" type="password" maxlength="8" placeholder="OTP" required>
                                    </div>
                                    <div style="display:flex;gap:0.7em;justify-content:center;margin-top:1.2em;">
                                            <button type="submit" class="hote-btn" id="hote-btn"
                                                    style="flex:1; min-width:110px; max-width:180px; height:42px; font-size:1.08em; padding:0; display:flex; align-items:center; justify-content:center;">Connecter</button>
                                            <a href="../index.html" class="hote-btn quitter" style="flex:1; min-width:110px; max-width:180px; height:42px; font-size:1.08em; padding:0; display:flex; align-items:center; justify-content:center; text-align:center; text-decoration:none;">Retour</a>
                                    </div>
                                    <div id="hote-error" style="color:red;text-align:center;margin-top:1em;"></div>
                                    <div style="text-align:center; margin-top:1.2em;">
                                            <a href="register.html" style="color:#0ff1ce; text-decoration:underline; font-weight:500;">Je n'ai pas de compte</a>
                                    </div>
                            </form>
                    </div>
                </div>
            </div>
        </div>
        <style>
        @media (max-width: 900px) {
            .hote-login-main {
                min-height:unset;
                padding-top:2em;
            }
            .hote-login-container {
                flex-direction:column;
                gap:2em;
                align-items:center;
            }
            .login-info-demo-outer, .hote-login-form-block-outer {
                width:100%;
                justify-content:center;
                align-items:center;
            }
            .login-info-demo, .hote-login-form-block {
                max-width:98vw;
                min-width:0;
                margin-bottom:1.5em;
            }
        }
        </style>
    <script>
document.getElementById('hote-login-form').addEventListener('submit', async function (e) {
    e.preventDefault();
    const email = document.getElementById('register-email').value;
    const otp = document.getElementById('hote-otp').value;
    const errorDiv = document.getElementById('hote-error');
    errorDiv.textContent = '';
    try {
        const response = await fetch('../backend/login.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ email, otp }),
            credentials: 'include'
        });
        const text = await response.text();
        console.log('RAW RESPONSE:', text);
        const data = JSON.parse(text);
        if (data.success) {
            errorDiv.style.color = 'green';
            errorDiv.textContent = data.message;
            if (data.user_nom) {
                sessionStorage.setItem('user_nom', data.user_nom);
            }
            console.log('Redirection...');
            setTimeout(() => { window.location.href = '../index.html'; }, 800);
        } else {
            errorDiv.style.color = 'red';
            errorDiv.textContent = data.error || 'Erreur lors de la connexion.';
            if (data.error && data.error.includes('d√©j√† connect√©')) {
                showAccountConnectedAlert();
            }
        }
    } catch (err) {
        errorDiv.style.color = 'red';
        errorDiv.textContent = 'Erreur serveur.';
    }
});

// Affiche une alerte modale si le compte est d√©j√† connect√©
function showAccountConnectedAlert() {
    // Supprime toute ancienne modale
    let old = document.getElementById('account-connected-modal');
    if (old) old.remove();
    const modal = document.createElement('div');
    modal.id = 'account-connected-modal';
    modal.innerHTML = `
      <div style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(10,16,40,0.92);z-index:3000;display:flex;align-items:center;justify-content:center;">
        <div style="background:#181c3a;padding:2.2em 2.5em 2em 2.5em;border-radius:1.2em;box-shadow:0 0 32px #00fff966,0 0 0 2px #00fff933,0 0 80px 8px #ff00ff22;text-align:center;max-width:90vw;border:1.5px solid #00fff9;">
          <div style='font-size:1.18em;color:#ff0055;font-weight:bold;margin-bottom:1.2em;'>Ce compte est d√©j√† connect√© ailleurs.<br>Veuillez d'abord vous d√©connecter.</div>
          <button id="btn-account-connected-ok" style="background:linear-gradient(90deg,#ff0055 0%,#ffe600 100%);color:#181c3a;font-weight:bold;font-size:1.13em;padding:0.7em 2.2em;border-radius:0.8em;border:none;box-shadow:0 0 16px #ff0055cc,0 0 32px #ffe60099;cursor:pointer;">OK</button>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    document.getElementById('btn-account-connected-ok').onclick = () => modal.remove();
}
</script>
</body>
    <script src="/Trouvix/js/session-nav.js"></script>
</html>
